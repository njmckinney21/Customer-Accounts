/*
Nathan McKinney and Levi Leuthold
Created: 5/17/17
Modified: 5/20/17 - Completed display all function
Group project: Customers Accounts
Rogue Community College - Computer Science Department - Teacher: Cynthia Patterson
*/
#include <iostream>
#include <fstream>
using std::cout;
using std::cin;
using std::endl;
using std::ios;
using std::fstream;



//const for array size
const int NAME_SIZE = 30;
const int DATE_SIZE = 11;
const int ADDRESS_SIZE = 250;
const int CITY_STATE_ZIP = 250;
const int PHONE_SIZE = 15;

//sructure defintion
struct Customer
{
	char name[NAME_SIZE];
	char address[ADDRESS_SIZE];
	char CityStateZip[CITY_STATE_ZIP];
	char telephoneNumber[PHONE_SIZE];
	double accountBalance;
	char lastPayment[DATE_SIZE];
};

//function prototypes
void addAccount(fstream &);
void viewAccount(fstream &);
void changeAccount(fstream &);
void deleteAccount(fstream &);
void viewAll(fstream &);

int main()
{
	fstream customerAccounts;
	int choice;
	//display the menu and get choice
	do
	{
		//display menu
		cout << "1. Add a new account\n";
		cout << "2. View an existing account\n";
		cout << "3. Change an existing account\n";
		cout << "4. Delete an existing account\n";
		cout << "5. View all the accounts\n";
		cout << "6. Exit\n";

		//get users choice
		cout << "Enter your choice(1-6): ";
		cin >> choice;

		//validate the choice
		while (choice < 1 || choice > 6)
		{
			cout << "Error re-enter your choice (between 1-6): ";
			cin >> choice;
		}

		//process the selection 
		switch (choice)
		{
		case 1:
			addAccount(customerAccounts);
			break;
		case 2:
			viewAccount(customerAccounts);
			break;
		case 3:
			changeAccount(customerAccounts);
			break;
		case 4:
			deleteAccount(customerAccounts);
			break;
		case 5:
			viewAll(customerAccounts);
			break;

		}
	} while (choice != 6);

	return 0;
}

void addAccount(fstream & customerFile)
{
	//inventory variable to hold input
	Customer account;

	//open the file to append to a file in binary format
	customerFile.open("customer.dat", ios::out | ios::app | ios::binary);

	if (customerFile.fail())
	{
		cout << "Error opening the file.\n";
		exit(EXIT_FAILURE);
	}

	cin.get();
	cout << "\nName (Enter the first name of no more than 29 characters): ";
	cin.getline(account.name, NAME_SIZE);
	cout << "Address: ";
	cin.getline(account.address, ADDRESS_SIZE);
	cout << "Enter the city, state, and zip: ";
	cin.getline(account.CityStateZip, CITY_STATE_ZIP);
	cout << "Telephone Number (No special characters): ";
	cin.getline(account.telephoneNumber, PHONE_SIZE);
	cout << "Account Balance: ";
	cin >> account.accountBalance;
	cout << "Date of last payment (format: dd/mm/yyyy): ";
	cin >> account.lastPayment;

	//write the record
	customerFile.write(reinterpret_cast<char*>(&account), sizeof(account));
	if (customerFile.fail())
	{
		cout << "Error writing record to file.\n";
	}
	else
	{
		cout << "Record written to file.\n";
	}
	customerFile.close();
}

void viewAccount(fstream & customerFile)
{
	int recordNum = 0;
	Customer account;
	customerFile.open("customer.dat", ios::in | ios::binary);

	if (customerFile.fail())
	{
		cout << "Error opening the file.\n";
		exit(EXIT_FAILURE);
	}

	cout << "Enter the number of the record you would like to review: ";
	cin >> recordNum;
	recordNum -= 1;

	customerFile.seekg(recordNum * sizeof(Customer), ios::beg);
	if (customerFile.fail())
	{
		cout << "\nError locating record.\n";
		customerFile.close();
		return;
	}

	customerFile.read(reinterpret_cast<char *>(&account), sizeof(account));
	customerFile.close();

	cout << "Name: " << account.name << endl;
	cout << "Address: " << account.address << endl;
	cout << "City, state, and zip: " << account.CityStateZip << endl;
	cout << "Account balance: " << account.accountBalance << endl;
	cout << "Last payment: " << account.lastPayment << endl;
	
}

void changeAccount(fstream & customerFile)
{
	Customer account;
	int accChoice;

	customerFile.open("customer.dat", ios::in | ios::out | ios::binary);

	if (customerFile.fail())
	{
		cout << "Error opening the file.\n";
		exit(EXIT_FAILURE);
	}

	cout << "Enter the record number of the item to edit: ";
	cin >> accChoice;
	accChoice -= 1;

	customerFile.seekg(accChoice * sizeof(account), ios::beg);

	if (customerFile.fail())
	{
		cout << "\nERROR locating record.\n";
		customerFile.close();
		return;
	}

	customerFile.read(reinterpret_cast<char *>(&account), sizeof(account));

	cout << "Name: " << account.name << endl;
	cout << "Address: " << account.address << endl;
	cout << "City, state, and zip: " << account.CityStateZip << endl;
	cout << "Account balance: " << account.accountBalance << endl;
	cout << "Last payment: " << account.lastPayment << endl;

	cin.get();
	cout << "\nName (Enter the first name of no more than 29 characters): ";
	cin.getline(account.name, NAME_SIZE);
	cout << "Address: ";
	cin.getline(account.address, ADDRESS_SIZE);
	cout << "Enter the city, state, and zip: ";
	cin.getline(account.CityStateZip, CITY_STATE_ZIP);
	cout << "Telephone Number (No special characters): ";
	cin.getline(account.telephoneNumber, PHONE_SIZE);
	cout << "Account Balance: ";
	cin >> account.accountBalance;
	cout << "Date of last payment (format: dd/mm/yyyy): ";
	cin >> account.lastPayment;

	customerFile.seekp(accChoice * sizeof(account), ios::beg);

	customerFile.write(reinterpret_cast<char *>(&account), sizeof(account));
	customerFile.close();

}

void deleteAccount(fstream & customerFile)
{

}

void viewAll(fstream & customerFile)
{
	Customer account;
	int count = 0;

	customerFile.open("customer.dat", ios::binary | ios::ate | ios::in);

	if (customerFile.fail())
	{
		cout << "Error opening the file.\n";
		exit(EXIT_FAILURE);
	}

	while (!customerFile.eof())
	{
		customerFile.seekg(count * sizeof(Customer), ios::beg);
		if (customerFile.fail())
		{
			cout << "\nError locating record.\n";
			customerFile.close();
			return;
		}

		customerFile.read(reinterpret_cast<char *>(&account), sizeof(account));
	

		cout << "Name: " << account.name << endl;
		cout << "Address: " << account.address << endl;
		cout << "City, state, and zip: " << account.CityStateZip << endl;
		cout << "Account balance: " << account.accountBalance << endl;
		cout << "Last payment: " << account.lastPayment << endl;

		count++;
	}
	customerFile.close();
}
